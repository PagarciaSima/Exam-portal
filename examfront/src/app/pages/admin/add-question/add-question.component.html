<mat-card [@slideIn] role="form" aria-labelledby="add-question-title">
    <!-- Title -->
    <h1 class="text-center" style="display: flex; align-items: center; justify-content: center;">
        <mat-icon aria-hidden="true" style="margin-right: 8px;">question_mark</mat-icon>
        {{ isEditMode ? ('EDIT_QUESTION' | translate) : ('ADD_QUESTION' | translate) }}&nbsp;-&nbsp;{{ qTitle }}
    </h1>
    <mat-card-content>
        <div class="bootstrap-wrapper">
            <div class="row">
                <div class="col-md-8 offset-md-2">
                    <form #questionForm="ngForm" aria-labelledby="add-question-title"
                        (ngSubmit)="formSubmit()" autocomplete="on" novalidate>
                        
                        <!-- Question Content con CKEditor (sin mat-form-field) -->
                        <div class="w100 mb10 mt-3">
                            <mat-label id="question-content-label" style="margin-bottom: 8px; display: block; font-size: 1.1rem; color: #3f51b5;">
                                {{ 'QUESTION' | translate }}
                            </mat-label>
                            <ckeditor
                                [editor]="Editor"
                                [(ngModel)]="question.content"
                                name="content"
                                required
                                #content="ngModel"
                                aria-required="true"
                                aria-labelledby="question-content-label"
                                aria-describedby="question-content-error"
                                [attr.aria-label]="'QUESTION' | translate"
                                [config]="{ placeholder: ('QUESTION' | translate) }"
                            ></ckeditor>
                            <div
                                id="question-content-error"
                                *ngIf="content.invalid && (content.dirty || content.touched)"
                                class="mat-error"
                                role="alert"
                                [attr.aria-label]="('QUESTION' | translate) + ' ' + ('IS_REQUIRED' | translate)"
                                style="color: #f44336; margin-top: 4px;"
                            >
                                {{ 'QUESTION' | translate }} {{ 'IS_REQUIRED' | translate }}
                            </div>
                        </div>

                        <!-- Option 1 -->
                        <mat-form-field class="w100 mt-3" appearance="outline">
                            <mat-label id="option1-label">{{ 'OPTION' | translate }} 1</mat-label>
                            <input
                                type="text"
                                name="option1"
                                matInput
                                [placeholder]="('OPTION' | translate) + ' 1'"
                                required
                                #option1="ngModel"
                                aria-required="true"
                                aria-labelledby="option1-label"
                                aria-describedby="option1-error"
                                [attr.aria-label]="('OPTION' | translate) + ' 1'"
                                [(ngModel)]="question.option1"
                            />
                            <mat-error
                                id="option1-error"
                                *ngIf="option1.invalid && (option1.dirty || option1.touched)"
                                role="alert"
                                [attr.aria-label]="('OPTION' | translate) + ' 1 ' + ('IS_REQUIRED' | translate)"
                            >
                                {{ 'OPTION' | translate }} 1 {{ 'IS_REQUIRED' | translate }}
                            </mat-error>
                        </mat-form-field>

                        <!-- Option 2 -->
                        <mat-form-field class="w100 mt-3" appearance="outline">
                            <mat-label id="option2-label">{{ 'OPTION' | translate }} 2</mat-label>
                            <input
                                type="text"
                                name="option2"
                                matInput
                                [placeholder]="('OPTION' | translate) + ' 2'"
                                required
                                #option2="ngModel"
                                aria-required="true"
                                aria-labelledby="option2-label"
                                aria-describedby="option2-error"
                                [attr.aria-label]="('OPTION' | translate) + ' 2'"
                                [(ngModel)]="question.option2"
                            />
                            <mat-error
                                id="option2-error"
                                *ngIf="option2.invalid && (option2.dirty || option2.touched)"
                                role="alert"
                                [attr.aria-label]="('OPTION' | translate) + ' 2 ' + ('IS_REQUIRED' | translate)"
                            >
                                {{ 'OPTION' | translate }} 2 {{ 'IS_REQUIRED' | translate }}
                            </mat-error>
                        </mat-form-field>

                        <!-- Option 3 -->
                        <mat-form-field class="w100 mt-3" appearance="outline">
                            <mat-label id="option3-label">{{ 'OPTION' | translate }} 3</mat-label>
                            <input
                                type="text"
                                name="option3"
                                matInput
                                [placeholder]="('OPTION' | translate) + ' 3'"
                                required
                                #option3="ngModel"
                                aria-required="true"
                                aria-labelledby="option3-label"
                                aria-describedby="option3-error"
                                [attr.aria-label]="('OPTION' | translate) + ' 3'"
                                [(ngModel)]="question.option3"
                            />
                            <mat-error
                                id="option3-error"
                                *ngIf="option3.invalid && (option3.dirty || option3.touched)"
                                role="alert"
                                [attr.aria-label]="('OPTION' | translate) + ' 3 ' + ('IS_REQUIRED' | translate)"
                            >
                                {{ 'OPTION' | translate }} 3 {{ 'IS_REQUIRED' | translate }}
                            </mat-error>
                        </mat-form-field>

                        <!-- Option 4 -->
                        <mat-form-field class="w100 mt-3" appearance="outline">
                            <mat-label id="option4-label">{{ 'OPTION' | translate }} 4</mat-label>
                            <input
                                type="text"
                                name="option4"
                                matInput
                                [placeholder]="('OPTION' | translate) + ' 4'"
                                required
                                #option4="ngModel"
                                aria-required="true"
                                aria-labelledby="option4-label"
                                aria-describedby="option4-error"
                                [attr.aria-label]="('OPTION' | translate) + ' 4'"
                                [(ngModel)]="question.option4"
                            />
                            <mat-error
                                id="option4-error"
                                *ngIf="option4.invalid && (option4.dirty || option4.touched)"
                                role="alert"
                                [attr.aria-label]="('OPTION' | translate) + ' 4 ' + ('IS_REQUIRED' | translate)"
                            >
                                {{ 'OPTION' | translate }} 4 {{ 'IS_REQUIRED' | translate }}
                            </mat-error>
                        </mat-form-field>

                        <!-- Correct Answer -->
                        <mat-form-field class="w100 mt-3" appearance="outline">
                            <mat-label id="correct-answer-label">{{ 'CORRECT_ANSWER' | translate }}</mat-label>
                            <mat-select
                                name="answer"
                                required
                                #answer="ngModel"
                                aria-required="true"
                                aria-labelledby="correct-answer-label"
                                aria-describedby="correct-answer-error"
                                [attr.aria-label]="'CORRECT_ANSWER' | translate"
                                [(ngModel)]="question.answer"
                                [placeholder]="'CORRECT_ANSWER' | translate"
                            >
                                <mat-option *ngIf="!question.option1" disabled>{{ 'OPTION' | translate }} 1 {{ 'IS_REQUIRED' | translate }}</mat-option>
                                <mat-option *ngIf="!question.option2" disabled>{{ 'OPTION' | translate }} 2 {{ 'IS_REQUIRED' | translate }}</mat-option>
                                <mat-option *ngIf="!question.option3" disabled>{{ 'OPTION' | translate }} 3 {{ 'IS_REQUIRED' | translate }}</mat-option>
                                <mat-option *ngIf="!question.option4" disabled>{{ 'OPTION' | translate }} 4 {{ 'IS_REQUIRED' | translate }}</mat-option>
                                <mat-option *ngIf="question.option1" [value]="question.option1">{{ question.option1 }}</mat-option>
                                <mat-option *ngIf="question.option2" [value]="question.option2">{{ question.option2 }}</mat-option>
                                <mat-option *ngIf="question.option3" [value]="question.option3">{{ question.option3 }}</mat-option>
                                <mat-option *ngIf="question.option4" [value]="question.option4">{{ question.option4 }}</mat-option>
                            </mat-select>
                            <mat-error
                                id="correct-answer-error"
                                *ngIf="answer.invalid && (answer.dirty || answer.touched)"
                                role="alert"
                                [attr.aria-label]="('CORRECT_ANSWER' | translate) + ' ' + ('IS_REQUIRED' | translate)"
                            >
                                {{ 'CORRECT_ANSWER' | translate }} {{ 'IS_REQUIRED' | translate }}
                            </mat-error>
                        </mat-form-field>

                        <!-- Question Image (botón con icono) -->
                        <div class="w100 mt-3" style="display: flex; align-items: center; gap: 12px;">
                            <button mat-raised-button color="accent" type="button" (click)="fileInput.click()">
                                <mat-icon aria-hidden="true">image</mat-icon>
                                {{ 'ADD_IMAGE' | translate }}
                            </button>
                            <input
                                #fileInput
                                id="question-image"
                                type="file"
                                accept="image/*"
                                style="display: none;"
                                (change)="onImageSelected($event)"
                            />
                            <span *ngIf="imageFile">{{ imageFile.name }}</span>
                        </div>

                        <!-- Add Question Button (dentro del form) -->
                        <div class="container text-center mt-3 px-0">
                            <div class="row">
                                <div class="col-12 col-md-6 mb-2 mb-md-0">
                                    <button
                                        mat-raised-button
                                        color="primary"
                                        [disabled]="questionForm.invalid"
                                        type="submit"
                                        class="w-100"
                                    >
                                        {{ isEditMode ? ('EDIT_QUESTION' | translate) : ('ADD_QUESTION' | translate) }}
                                    </button>
                                </div>
                                <div class="col-12 col-md-6">
                                    <button
                                        mat-raised-button
                                        color="accent"
                                        [routerLink]="['/admin/view-questions', qId, qTitle]"
                                        type="button"
                                        class="w-100"
                                    >
                                        {{ 'BACK_TO_QUIZ' | translate }}
                                    </button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </mat-card-content>
</mat-card>

